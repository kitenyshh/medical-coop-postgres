<%- include('layout', {
  body: `
    <div class="reports-container">
      <h2>üìä –û—Ç—á—ë—Ç–Ω–æ—Å—Ç—å</h2>

      <div class="report-section">
        <h3>üìÖ –í—ã–∑–æ–≤—ã –ø–æ –¥–∞—Ç–µ</h3>
        <form method="GET" action="/reports" class="form-row">
          <input type="date" name="date" value="${date}">
          <button type="submit" class="button-secondary">–ü–æ–∫–∞–∑–∞—Ç—å</button>
        </form>
        <table>
          <thead>
            <tr>
              <th>–î–∞—Ç–∞</th>
              <th>–ö–æ–ª-–≤–æ –≤–∏–∑–∏—Ç–æ–≤</th>
              <th>–í—Ä–∞—á–∏</th>
            </tr>
          </thead>
          <tbody>
            ${
              visitsByDate.length === 0
                ? '<tr><td colspan="3">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É</td></tr>'
                : visitsByDate.map(r => `
                    <tr>
                        <td>${
                            r.visit_date
                                ? (() => {
                                    const d = new Date(r.visit_date);
                                    const dd = String(d.getDate()).padStart(2, '0');
                                    const mm = String(d.getMonth() + 1).padStart(2, '0');
                                    const yyyy = d.getFullYear();
                                    return `${dd}.${mm}.${yyyy}`;
                                })()
                                : '-'
                        }</td>


                      <td>${r.visits_count}</td>
                      <td>${r.doctors_list || ''}</td>
                    </tr>
                  `).join('')
            }
          </tbody>
        </table>
      </div>

      <div class="report-section">
        <h3>üè• –ë–æ–ª—å–Ω—ã–µ –ø–æ –¥–∏–∞–≥–Ω–æ–∑—É</h3>
        <table>
          <thead>
            <tr>
              <th>–î–∏–∞–≥–Ω–æ–∑</th>
              <th>–ö–æ–ª-–≤–æ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤</th>
            </tr>
          </thead>
          <tbody>
            ${
              byDiagnosis.length === 0
                ? '<tr><td colspan="2">–î–∞–Ω–Ω—ã—Ö –ø–æ–∫–∞ –Ω–µ—Ç</td></tr>'
                : byDiagnosis.map(r => `
                    <tr>
                      <td>${r.diagnosis_name}</td>
                      <td>${r.patients_count}</td>
                    </tr>
                  `).join('')
            }
          </tbody>
        </table>
      </div>

      <div class="report-section">
        <h3>üíä –õ–µ–∫–∞—Ä—Å—Ç–≤–∞ –∏ –ø–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã</h3>
        <table>
          <thead>
            <tr>
              <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
              <th>–ü—Ä–∏—ë–º</th>
              <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
              <th>–ü–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã</th>
            </tr>
          </thead>
          <tbody>
            ${
              medicines.length === 0
                ? '<tr><td colspan="4">–õ–µ–∫–∞—Ä—Å—Ç–≤–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</td></tr>'
                : medicines.map(m => `
                    <tr>
                      <td>${m.medicine_name}</td>
                      <td>${m.intake_method || '-'}</td>
                      <td>${m.action_description || '-'}</td>
                      <td>${m.side_effects || '-'}</td>
                    </tr>
                  `).join('')
            }
          </tbody>
        </table>
      </div>
    </div>
  `,
  doctor
}) %>
